import{Ka as E,e as a,g as c,k as g,s as u,u as h,x as m}from"./chunk-BXB7KQTQ.js";var A=(()=>{class d{constructor(e){this.http=e,this.CLASSES_STORAGE_KEY="mobaria_classes",this.ZONES_STORAGE_KEY="mobaria_zones",this.CLASSES_TIMESTAMP_KEY="mobaria_classes_timestamp",this.ZONES_TIMESTAMP_KEY="mobaria_zone_timestamp",this.CACHE_VALIDITY_DURATION=24*60*60*1e3}getQuests(){return a([])}getQuestById(e){return a(void 0)}getMonsters(){return a([])}getMonsterById(e){return a(void 0)}isCacheValid(){let e=localStorage.getItem(this.CLASSES_TIMESTAMP_KEY);if(!e)return!1;let s=parseInt(e,10);return Date.now()-s<this.CACHE_VALIDITY_DURATION}clearClassesCache(){localStorage.removeItem(this.CLASSES_STORAGE_KEY),localStorage.removeItem(this.CLASSES_TIMESTAMP_KEY),console.log("Cache des classes effac\xE9")}getClasses(){let e=localStorage.getItem(this.CLASSES_STORAGE_KEY);return e&&this.isCacheValid()?(console.log("Classes charg\xE9es depuis le localStorage"),a(JSON.parse(e))):this.http.get("assets/data/class-details.json").pipe(u(s=>{console.log("Classes charg\xE9es depuis le fichier JSON et stock\xE9es dans localStorage"),localStorage.setItem(this.CLASSES_STORAGE_KEY,JSON.stringify(s)),localStorage.setItem(this.CLASSES_TIMESTAMP_KEY,Date.now().toString())}),g(s=>(console.error("Erreur lors du chargement des classes:",s),e?(console.log("Utilisation des donn\xE9es en cache comme solution de secours"),a(JSON.parse(e))):a([]))))}getClassById(e){let s=localStorage.getItem(this.CLASSES_STORAGE_KEY);if(s&&this.isCacheValid()){console.log(`Recherche de la classe avec l'ID ${e} dans le localStorage`);let t=JSON.parse(s);return a(t.find(o=>o.id==e))}return this.getClasses().pipe(c(t=>(console.log(`Recherche de la classe avec l'ID ${e} apr\xE8s chargement du JSON`),t.find(o=>o.id==e))),g(t=>{if(console.error(`Erreur lors du chargement de la classe avec l'ID ${e}:`,t),s){console.log("Tentative d'utilisation des donn\xE9es en cache comme solution de secours");let o=JSON.parse(s);return a(o.find(n=>n.id==e))}return a(void 0)}))}getZones(){let e=localStorage.getItem(this.ZONES_STORAGE_KEY);if(e&&this.isCacheValid()){console.log("Zones charg\xE9es depuis le localStorage");let s=JSON.parse(e);return a(s)}return this.http.get("assets/data/zones.json").pipe(u(s=>{console.log("Zones charg\xE9es depuis le fichier JSON et stock\xE9es dans localStorage"),localStorage.setItem(this.ZONES_STORAGE_KEY,JSON.stringify(s)),localStorage.setItem(this.ZONES_TIMESTAMP_KEY,Date.now().toString())}),c(s=>this.populateZonesWithDetails(s)))}populateZonesWithDetails(e){let s=this.http.get("assets/data/mobs.json"),t=this.http.get("assets/data/dungeon.json");return s.subscribe(o=>{t.subscribe(n=>{e.forEach(r=>{console.log(`Traitement de la zone: ${r.name}`),console.log(r.mobs_outside),r.mobs_outside=r.mobs_outside.map(i=>o.find(l=>l.id===Number(i))).filter(i=>i!==void 0),console.log(r.mobs_outside),r.dungeons=r.dungeons?.map(i=>{let l=n.find(S=>S.id===Number(i));return l&&(l.mobs=l.mobs?.map(S=>o.find(p=>p.id===Number(S))).filter(S=>S!==void 0)||[]),l}).filter(i=>i!==void 0)||[],localStorage.setItem(this.ZONES_STORAGE_KEY,JSON.stringify(e))})})}),console.log("ZONE FINALE",e),e}getZoneById(e){let s=parseInt(e,10),t=localStorage.getItem(this.ZONES_STORAGE_KEY);if(t&&this.isCacheValid()){console.log(`Recherche de la classe avec l'ID ${s} dans le localStorage`);let o=JSON.parse(t);return console.log(`Zones trouv\xE9es: ${o.length} ${s}`),console.log(o,a(o.find(n=>n.id==s))),a(o.find(n=>n.id==s))}return this.getZones().pipe(c(o=>(console.log(`Recherche de la classe avec l'ID ${s} apr\xE8s chargement du JSON`),o.find(n=>n.id==s))),g(o=>{if(console.error(`Erreur lors du chargement de la classe avec l'ID ${s}:`,o),t){console.log("Tentative d'utilisation des donn\xE9es en cache comme solution de secours");let n=JSON.parse(t);return a(n.find(r=>r.id==s))}return a(void 0)}))}getDungeonsByIds(e){return this.http.get("assets/data/dungeon.json").pipe(c(s=>s.filter(t=>e.includes(t.id))))}getMobsByIds(e){return this.http.get("assets/data/mobs.json").pipe(c(s=>s.filter(t=>e.includes(t.id))))}static{this.\u0275fac=function(s){return new(s||d)(m(E))}}static{this.\u0275prov=h({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})();export{A as a};
